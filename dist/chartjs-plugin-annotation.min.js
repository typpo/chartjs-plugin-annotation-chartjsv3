/*!
* chartjs-plugin-annotation v1.0.2
* https://www.chartjs.org/chartjs-plugin-annotation/index
 * (c) 2021 chartjs-plugin-annotation Contributors
 * Released under the MIT License
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js-v3"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js-v3","chart.js/helpers"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["chartjs-plugin-annotation"]=t(e.ChartJsV3,e.Chart.helpers)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(e);const{distanceBetweenPoints:i}=o.default.helpers,a=o.default.helpers.callback,r=["click","dblclick"],s=["enter","leave"],l=r.concat(s);function d(e,t,n,o){if(t.listened)switch(n.type){case"mousemove":case"mouseout":!function(e,t,n){if(!t.moveListened)return;let o;"mousemove"===n.type&&(o=h(t.elements,n));const i=t.hovered;t.hovered=o,function(e,t,n,o){const{previous:i,element:a}=n;i&&i!==a&&c(e,i.options.leave||t.listeners.leave,i,o);a&&a!==i&&c(e,a.options.enter||t.listeners.enter,a,o)}(e,t,{previous:i,element:o},n)}(e,t,n);break;case"click":!function(e,t,n,o){const i=t.listeners,a=h(t.elements,n);if(a){const t=a.options,r=t.dblclick||i.dblclick,s=t.click||i.click;a.clickTimeout?(clearTimeout(a.clickTimeout),delete a.clickTimeout,c(e,r,a,n)):r?a.clickTimeout=setTimeout((()=>{delete a.clickTimeout,c(e,s,a,n)}),o.dblClickSpeed):c(e,s,a,n)}}(e,t,n,o)}}function c(e,t,n,o){a(t,[{chart:e,element:n},o])}function h(e,t){let n=Number.POSITIVE_INFINITY;return e.filter((e=>e.options.display&&e.inRange(t.x,t.y))).reduce(((e,o)=>{const a=o.getCenterPoint(),r=i(t,a);return r<n?(e=[o],n=r):r===n&&e.push(o),e}),[]).sort(((e,t)=>e._index-t._index)).slice(0,1)[0]}const{isFinite:u}=o.default.helpers,f=(e,t,n)=>Math.min(n,Math.max(t,e));function x(e,t,n){for(const o of Object.keys(e))e[o]=f(e[o],t,n);return e}function y(e,t,n){return t="number"==typeof t?t:e.parse(t),u(t)?e.getPixelForValue(t):n}const{addRoundedRectPath:b,toTRBLCorners:p,valueOrDefault:g}=o.default.helpers;class m extends e.Element{inRange(e,t,n){const{x:o,y:i,width:a,height:r}=this.getProps(["x","y","width","height"],n);return e>=o&&e<=o+a&&t>=i&&t<=i+r}getCenterPoint(e){const{x:t,y:n,width:o,height:i}=this.getProps(["x","y","width","height"],e);return{x:t+o/2,y:n+i/2}}draw(e){const{x:t,y:n,width:o,height:i,options:a}=this;e.save(),e.lineWidth=a.borderWidth,e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,e.setLineDash(a.borderDash),e.lineDashOffset=a.borderDashOffset,e.beginPath(),b(e,{x:t,y:n,w:o,h:i,radius:x(p(g(a.cornerRadius,a.borderRadius)),0,Math.min(o,i)/2)}),e.closePath(),e.fill(),a.borderWidth&&e.stroke(),e.restore()}resolveElementProperties(e,t){const n=e.scales[t.xScaleID],o=e.scales[t.yScaleID];let i,a,{top:r,left:s,bottom:l,right:d}=e.chartArea;return n||o?(n&&(i=y(n,t.xMin,s),a=y(n,t.xMax,d),s=Math.min(i,a),d=Math.max(i,a)),o&&(i=y(o,t.yMin,l),a=y(o,t.yMax,r),r=Math.min(i,a),l=Math.max(i,a)),{x:s,y:r,x2:d,y2:l,width:d-s,height:l-r}):{options:{}}}}m.id="boxAnnotation",m.defaults={display:!0,adjustScaleRange:!0,borderDash:[],borderDashOffset:0,borderWidth:1,borderRadius:0,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},m.defaultRoutes={borderColor:"color",backgroundColor:"color"};const{addRoundedRectPath:w,isArray:M,toFontString:v,toRadians:D,toTRBLCorners:P,valueOrDefault:k}=o.default.helpers,I=Math.PI,S=(e,t,n)=>({x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}),C=(e,t,n)=>S(t,n,Math.abs((e-t.y)/(n.y-t.y))).x,O=(e,t,n)=>S(t,n,Math.abs((e-t.x)/(n.x-t.x))).y;function R({x:e,y:t,x2:n,y2:o},{top:i,right:a,bottom:r,left:s}){return!(e<s&&n<s||e>a&&n>a||t<i&&o<i||t>r&&o>r)}function T({x:e,y:t},n,{top:o,right:i,bottom:a,left:r}){return e<r&&(t=O(r,{x:e,y:t},n),e=r),e>i&&(t=O(i,{x:e,y:t},n),e=i),t<o&&(e=C(o,{x:e,y:t},n),t=o),t>a&&(e=C(a,{x:e,y:t},n),t=a),{x:e,y:t}}class A extends e.Element{intersects(e,t,n=.001){const o=e=>e*e,{x:i,y:a,x2:r,y2:s}=this,l=r-i,d=s-a,c=o(l)+o(d),h=0===c?-1:((e-i)*l+(t-a)*d)/c;let u,f;return h<0?(u=i,f=a):h>1?(u=r,f=s):(u=i+h*l,f=a+h*d),o(e-u)+o(t-f)<n}labelIsVisible(e){const t=this.options.label;return(!e||R(this,e))&&t&&t.enabled&&t.content}isOnLabel(e,t){const{labelRect:n}=this;if(!n||!this.labelIsVisible())return!1;const{x:o,y:i}=(a={x:e,y:t},r=n,s=-n.rotation,l=Math.cos(s),d=Math.sin(s),c=r.x,h=r.y,{x:c+l*(a.x-c)-d*(a.y-h),y:h+d*(a.x-c)+l*(a.y-h)});var a,r,s,l,d,c,h;const u=n.width/2,f=n.height/2;return o>=n.x-u&&o<=n.x+u&&i>=n.y-f&&i<=n.y+f}inRange(e,t){const n=this.options.borderWidth||1;return this.intersects(e,t,n)||this.isOnLabel(e,t)}getCenterPoint(){return{x:(this.x2+this.x)/2,y:(this.y2+this.y)/2}}draw(e){const{x:t,y:n,x2:o,y2:i,options:a}=this;e.save(),e.lineWidth=a.borderWidth,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash),e.lineDashOffset=a.borderDashOffset,e.beginPath(),e.moveTo(t,n),e.lineTo(o,i),e.stroke(),e.restore()}drawLabel(e,t){this.labelIsVisible(t)&&(e.save(),function(e,t,n){const o=t.options.label;e.font=v(o.font);const{width:i,height:a}=function(e,t){const n=t.content;if(n instanceof Image)return{width:j(n.width,t.width)+2*t.xPadding,height:j(n.height,t.height)+2*t.yPadding};const o=M(n)?n:[n],i=o.length;let a=0;for(let t=0;t<i;t++){const n=o[t];E.has(n)||E.set(n,e.measureText(n).width),a=Math.max(a,E.get(n))}return a+=2*t.xPadding,{width:a,height:i*t.font.size+(i+1)*t.yPadding}}(e,o),r=t.labelRect=function(e,t,n,o){const i=e.options.label,{xAdjust:a,yAdjust:r,xPadding:s,yPadding:l,position:d}=i,c={x:e.x,y:e.y},h={x:e.x2,y:e.y2},u="auto"===i.rotation?function(e){const{x:t,y:n,x2:o,y2:i}=e,a=Math.atan2(i-n,o-t);return a>I/2?a-I:a<I/-2?a+I:a}(e):D(i.rotation),f=function(e,t,n){const o=Math.cos(n),i=Math.sin(n);return{w:Math.abs(e*o)+Math.abs(t*i),h:Math.abs(e*i)+Math.abs(t*o)}}(t,n,u),x=function(e,t,n,o){let i=.5;const a=function(e,t){const{x:n,x2:o,y:i,y2:a}=e,r=Math.min(i,a)-t.top,s=Math.min(n,o)-t.left,l=t.bottom-Math.max(i,a),d=t.right-Math.max(n,o);return{x:Math.min(s,d),y:Math.min(r,l),dx:s<d?1:-1,dy:r<l?1:-1}}(e,o),r=e.options.label;"start"===t?i=L({w:e.x2-e.x,h:e.y2-e.y},n,r,a):"end"===t&&(i=1-L({w:e.x-e.x2,h:e.y-e.y2},n,r,a));return i}(e,d,f,o),y=S(c,h,x),b={size:f.w,min:o.left,max:o.right,padding:s},p={size:f.h,min:o.top,max:o.bottom,padding:l};return{x:W(y.x,b)+a,y:W(y.y,p)+r,width:t,height:n,rotation:u}}(t,i,a,n);e.translate(r.x,r.y),e.rotate(r.rotation),e.fillStyle=o.backgroundColor;const s=function(e,t){if(t.borderWidth)return e.lineCap=t.borderCapStyle,e.setLineDash(t.borderDash),e.lineDashOffset=t.borderDashOffset,e.lineJoin=t.borderJoinStyle,e.lineWidth=t.borderWidth,e.strokeStyle=t.borderColor,!0}(e,o);e.beginPath(),w(e,{x:-i/2,y:-a/2,w:i,h:a,radius:x(P(k(o.cornerRadius,o.borderRadius)),0,Math.min(i,a)/2)}),e.closePath(),e.fill(),s&&e.stroke();if(e.fillStyle=o.color,M(o.content)){e.textAlign=o.textAlign;const t=function(e,t){const{textAlign:n,xPadding:o}=e;if("start"===n)return-t/2+o;if("end"===n)return+t/2-o;return 0}(o,i);let n=-a/2+o.yPadding;for(let i=0;i<o.content.length;i++)e.textBaseline="top",e.fillText(o.content[i],t,n),n+=o.font.size+o.yPadding}else if(o.content instanceof Image){const t=-i/2+o.xPadding,n=-a/2+o.yPadding;e.drawImage(o.content,t,n,i-2*o.xPadding,a-2*o.yPadding)}else e.textAlign="center",e.textBaseline="middle",e.fillText(o.content,0,0)}(e,this,t),e.restore())}resolveElementProperties(e,t){const n=e.scales[t.scaleID];let o,i,{top:a,left:r,bottom:s,right:l}=e.chartArea;if(n)o=y(n,t.value,NaN),i=y(n,t.endValue,o),n.isHorizontal()?(r=o,l=i):(a=o,s=i);else{const n=e.scales[t.xScaleID],o=e.scales[t.yScaleID];n&&(r=y(n,t.xMin,r),l=y(n,t.xMax,l)),o&&(a=y(o,t.yMin,a),s=y(o,t.yMax,s))}return R({x:r,y:a,x2:l,y2:s},e.chartArea)?function(e,t,n){const{x:o,y:i}=T(e,t,n),{x:a,y:r}=T(t,e,n);return{x:o,y:i,x2:a,y2:r,width:Math.abs(a-o),height:Math.abs(r-i)}}({x:r,y:a},{x:l,y:s},e.chartArea):{x:r,y:a,x2:l,y2:s,width:Math.abs(l-r),height:Math.abs(s-a)}}}function j(e,t){return"number"==typeof t?t:"string"==typeof t?("string"==typeof(n=t)&&n.endsWith("%")&&parseFloat(n)/100)*e:e;var n}A.id="lineAnnotation",A.defaults={display:!0,adjustScaleRange:!0,borderWidth:2,borderDash:[],borderDashOffset:0,label:{backgroundColor:"rgba(0,0,0,0.8)",borderCapStyle:"butt",borderColor:"black",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:6,borderWidth:0,drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:"bold",weight:void 0},color:"#fff",xPadding:6,yPadding:6,rotation:0,position:"center",xAdjust:0,yAdjust:0,textAlign:"center",enabled:!1,content:null},value:void 0,endValue:void 0,scaleID:void 0,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},A.defaultRoutes={borderColor:"color"};const E=new Map;function L(e,t,n,o){const{xPadding:i,yPadding:a}=n,r=e.w*o.dx,s=e.h*o.dy,l=r>0&&(t.w/2+i-o.x)/r,d=s>0&&(t.h/2+a-o.y)/s;return f(Math.max(l,d),0,.25)}function W(e,t){const{size:n,min:o,max:i,padding:a}=t,r=n/2;return n>i-o?(i+o)/2:(o>=e-a-r&&(e=o+a+r),i<=e+a+r&&(e=i-a-r),e)}class V extends m{inRange(e,t){return function(e,t){const{width:n,height:o}=t,i=t.getCenterPoint(!0),a=n/2,r=o/2;if(a<=0||r<=0)return!1;return Math.pow(e.x-i.x,2)/Math.pow(a,2)+Math.pow(e.y-i.y,2)/Math.pow(r,2)<=1}({x:e,y:t},this)}draw(e){const{width:n,height:o,options:i}=this,a=this.getCenterPoint();e.save(),e.translate(a.x,a.y),i.rotation&&e.rotate(t.toRadians(i.rotation)),e.beginPath(),e.lineWidth=i.borderWidth,e.strokeStyle=i.borderColor,e.fillStyle=i.backgroundColor,e.setLineDash(i.borderDash),e.lineDashOffset=i.borderDashOffset,e.ellipse(0,0,o/2,n/2,Math.PI/2,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}}V.id="ellipseAnnotation",V.defaults={display:!0,adjustScaleRange:!0,borderDash:[],borderDashOffset:0,borderWidth:1,rotation:0,xScaleID:"x",xMin:void 0,xMax:void 0,yScaleID:"y",yMin:void 0,yMax:void 0},V.defaultRoutes={borderColor:"color",backgroundColor:"color"};const{scaleValue:N}=o.default.helpers;class _ extends e.Element{inRange(e,t){const{width:n,options:o}=this,i=this.getCenterPoint(!0),a=n/2+o.borderWidth;return!(a<=0)&&Math.pow(e-i.x,2)+Math.pow(t-i.y,2)<=Math.pow(a,2)}getCenterPoint(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}draw(e){const{x:t,y:n,width:o,options:i}=this;e.save(),e.lineWidth=i.borderWidth,e.strokeStyle=i.borderColor,e.fillStyle=i.backgroundColor,e.setLineDash(i.borderDash),e.lineDashOffset=i.borderDashOffset,e.beginPath(),e.arc(t,n,o/2,0,2*Math.PI),e.fill(),e.stroke(),e.restore()}resolveElementProperties(e,t){const{chartArea:n,scales:o}=e,i=o[t.xScaleID],a=o[t.yScaleID];let r=n.width/2,s=n.height/2;return i&&(r=N(i,t.xValue,r)),a&&(s=N(a,t.yValue,s)),{x:r,y:s,width:2*t.radius,height:2*t.radius}}}_.id="pointAnnotation",_.defaults={display:!0,adjustScaleRange:!0,borderDash:[],borderDashOffset:0,borderWidth:1,radius:10,xScaleID:"x",xValue:void 0,yScaleID:"y",yValue:void 0},_.defaultRoutes={borderColor:"color",backgroundColor:"color"};const{clipArea:z,unclipArea:F,isFinite:B,valueOrDefault:J,isObject:$,isArray:U}=o.default.helpers,Y=new Map,q={box:m,line:A,ellipse:V,point:_};Object.keys(q).forEach((t=>{e.defaults.describe(`elements.${q[t].id}`,{_fallback:"plugins.annotation"})}));var H={id:"annotation",version:"1.0.2",afterRegister(){e.Chart.register(q)},afterUnregister(){e.Chart.unregister(q)},beforeInit(e){Y.set(e,{annotations:[],elements:[],listeners:{},listened:!1,moveListened:!1})},beforeUpdate(e,t,n){const o=Y.get(e).annotations=[];let i=n.annotations;$(i)?Object.keys(i).forEach((e=>{const t=i[e];$(t)&&(t.id=e,o.push(t))})):U(i)&&o.push(...i)},afterDataLimits(e,t){const n=Y.get(e);!function(e,t,n){const o=function(e,t){const n=e.axis,o=e.id,i=n+"ScaleID";let a=J(e.min,Number.NEGATIVE_INFINITY),r=J(e.max,Number.POSITIVE_INFINITY);for(const s of t)if(s.scaleID===o)for(const t of["value","endValue"]){const n=s[t];if(n){const t=e.parse(n);a=Math.min(a,t),r=Math.max(r,t)}}else if(s[i]===o)for(const t of[n+"Min",n+"Max",n+"Value"]){const n=s[t];if(n){const t=e.parse(n);a=Math.min(a,t),r=Math.max(r,t)}}return{min:a,max:r}}(t,n);let i=!1;B(o.min)&&void 0===t.options.min&&void 0===t.options.suggestedMin&&(i=t.min!==o.min,t.min=o.min);B(o.max)&&void 0===t.options.max&&void 0===t.options.suggestedMax&&(i=t.max!==o.max,t.max=o.max);i&&"function"==typeof t.handleTickRangeOptions&&t.handleTickRangeOptions()}(0,t.scale,n.annotations.filter((e=>e.display&&e.adjustScaleRange)))},afterUpdate(t,n,o){const i=Y.get(t);!function(e,t,n){const o=t.annotations||[];t.listened=!1,t.moveListened=!1,l.forEach((e=>{"function"==typeof n[e]&&(t.listened=!0,t.listeners[e]=n[e])})),s.forEach((e=>{"function"==typeof n[e]&&(t.moveListened=!0)})),t.listened&&t.moveListened||o.forEach((e=>{t.listened||r.forEach((n=>{"function"==typeof e[n]&&(t.listened=!0)})),t.moveListened||s.forEach((n=>{"function"==typeof e[n]&&(t.listened=!0,t.moveListened=!0)}))}))}(0,i,o),function(t,n,o,i){const a=function(t,n,o){if("reset"===o||"none"===o||"resize"===o)return G;return new e.Animations(t,n)}(t,o.animations,i),r=n.annotations,s=function(e,t){const n=t.length,o=e.length;if(o<n){const t=n-o;e.splice(o,0,...new Array(t))}else o>n&&e.splice(n,o-n);return e}(n.elements,r);for(let e=0;e<r.length;e++){const n=r[e];let o=s[e];const i=q[n.type]||q.line;o&&o instanceof i||(o=s[e]=new i);const l=K(n.setContext(X(t,o,n))),d=o.resolveElementProperties(t,l);d.skip=isNaN(d.x)||isNaN(d.y),d.options=l,a.update(o,d)}}(t,i,o,n.mode)},beforeDatasetsDraw(e){Z(e,"beforeDatasetsDraw")},afterDatasetsDraw(e){Z(e,"afterDatasetsDraw")},beforeDraw(e){Z(e,"beforeDraw")},afterDraw(e){Z(e,"afterDraw")},beforeEvent(e,t,n){d(e,Y.get(e),t.event,n)},destroy(e){Y.delete(e)},_getState:e=>Y.get(e),defaults:{drawTime:"afterDatasetsDraw",dblClickSpeed:350,animations:{numbers:{properties:["x","y","x2","y2","width","height"],type:"number"}},label:{drawTime:null}},descriptors:{_indexable:!1,_scriptable:e=>!l.includes(e),annotations:{_allKeys:!1,_fallback:(e,t)=>`elements.${q[t.type||"line"].id}`}},additionalOptionScopes:[""]};const G={update:Object.assign};function K(e){const t=q[e.type]||q.line,n={};n.id=e.id,n.type=e.type,n.drawTime=e.drawTime,Object.assign(n,Q(e,t.defaults),Q(e,t.defaultRoutes));for(const t of l)n[t]=e[t];return n}function Q(e,t){const n={};for(const o of Object.keys(t)){const i=t[o],a=e[o];n[o]=$(i)?Q(a,i):a}return n}function X(e,t,n){return t.$context||(t.$context=Object.assign(Object.create(e.getContext()),{element:t,id:n.id,type:"annotation"}))}function Z(e,t){const{ctx:n,chartArea:o}=e,i=Y.get(e).elements.filter((e=>!e.skip&&e.options.display));z(n,o),i.forEach((e=>{e.options.drawTime===t&&e.draw(n)})),F(n),i.forEach((e=>{"drawLabel"in e&&e.options.label&&(e.options.label.drawTime||e.options.drawTime)===t&&e.drawLabel(n,o)}))}return e.Chart.register(H),H}));
