/*!
* chartjs-plugin-annotation v1.2.2
* https://www.chartjs.org/chartjs-plugin-annotation/index
 * (c) 2022 chartjs-plugin-annotation Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js-v3"),require("canvas")):"function"==typeof define&&define.amd?define(["chart.js-v3","canvas"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["chartjs-plugin-annotation"]=e(t.ChartJsV3,t.canvas)}(this,(function(t,e){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=o(t);const{distanceBetweenPoints:i,defined:r,callback:s}=n.default.helpers,a=["click","dblclick"],d=["enter","leave"],l=a.concat(d);function h(t,e,o){if(t.listened)switch(e.type){case"mousemove":case"mouseout":!function(t,e){if(!t.moveListened)return;let o;"mousemove"===e.type&&(o=u(t.elements,e));const n=t.hovered;t.hovered=o,function(t,e,o){const{previous:n,element:i}=e;n&&n!==i&&c(n.options.leave||t.listeners.leave,n,o);i&&i!==n&&c(i.options.enter||t.listeners.enter,i,o)}(t,{previous:n,element:o},e)}(t,e);break;case"click":!function(t,e,o){const n=t.listeners,i=u(t.elements,e);if(i){const t=i.options,r=t.dblclick||n.dblclick,s=t.click||n.click;i.clickTimeout?(clearTimeout(i.clickTimeout),delete i.clickTimeout,c(r,i,e)):r?i.clickTimeout=setTimeout((()=>{delete i.clickTimeout,c(s,i,e)}),o.dblClickSpeed):c(s,i,e)}}(t,e,o)}}function c(t,e,o){s(t,[e.$context,o])}function u(t,e){let o=Number.POSITIVE_INFINITY;return t.filter((t=>t.options.display&&t.inRange(e.x,e.y))).reduce(((t,n)=>{const r=n.getCenterPoint(),s=i(e,r);return s<o?(t=[n],o=s):s===o&&t.push(n),t}),[]).sort(((t,e)=>t._index-e._index)).slice(0,1)[0]}const{isFinite:f,valueOrDefault:b,defined:p}=n.default.helpers;function x(t,e,o){const n=function(t,e){const o=t.axis,n=t.id,i=o+"ScaleID",r={min:b(t.min,Number.NEGATIVE_INFINITY),max:b(t.max,Number.POSITIVE_INFINITY)};for(const s of e)s.scaleID===n?w(s,t,["value","endValue"],r):s[i]===n&&w(s,t,[o+"Min",o+"Max",o+"Value"],r);return r}(e,o);let i=y(e,n,"min","suggestedMin");i=y(e,n,"max","suggestedMax")||i,i&&"function"==typeof e.handleTickRangeOptions&&e.handleTickRangeOptions()}function y(t,e,o,n){if(f(e[o])&&!function(t,e,o){return p(t[e])||p(t[o])}(t.options,o,n)){const n=t[o]!==e[o];return t[o]=e[o],n}}function g(t,e){for(const o of["scaleID","xScaleID","yScaleID"])t[o]&&!e[t[o]]&&console.warn(`No scale found with id '${t[o]}' for annotation '${t.id}'`)}function w(t,e,o,n){for(const i of o){const o=t[i];if(p(o)){const t=e.parse(o);n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)}}}const m=(t,e,o)=>Math.min(o,Math.max(e,t));function v(t,e,o){for(const n of Object.keys(t))t[n]=m(t[n],e,o);return t}function M(t,e,{x:o,y:n,width:i,height:r},s){const a=s/2||0;return t>=o-a&&t<=o+i+a&&e>=n-a&&e<=n+r+a}function S(t,e){const{x:o,y:n}=t.getProps(["x","y"],e);return{x:o,y:n}}const C=(t,e)=>e>t||t.length>e.length&&t.substr(0,e.length)===e;const{isObject:D,valueOrDefault:k,defined:P}=n.default.helpers,O=t=>"string"==typeof t&&t.endsWith("%"),j=t=>m(parseFloat(t)/100,0,1);function A(t,e){return"start"===e?0:"end"===e?t:O(e)?j(e)*t:t/2}function I(t,e){return"number"==typeof e?e:O(e)?j(e)*t:t}function W(t){return D(t)?{x:k(t.x,"center"),y:k(t.y,"center")}:{x:t=k(t,"center"),y:t}}function T(t){return t&&(P(t.xValue)||P(t.yValue))}const{addRoundedRectPath:R,isArray:E,toFont:Y,toTRBLCorners:X,valueOrDefault:V}=n.default.helpers,H=new Map;function N(t){return t instanceof e.Image||t instanceof Image||t instanceof HTMLCanvasElement}function _(t,e){if(e&&e.borderWidth)return t.lineCap=e.borderCapStyle,t.setLineDash(e.borderDash),t.lineDashOffset=e.borderDashOffset,t.lineJoin=e.borderJoinStyle,t.lineWidth=e.borderWidth,t.strokeStyle=e.borderColor,!0}function z(t,e){t.shadowColor=e.backgroundShadowColor,t.shadowBlur=e.shadowBlur,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY}function L(t,e){const o=e.content;if(N(o))return{width:I(o.width,e.width),height:I(o.height,e.height)};const n=Y(e.font),i=E(o)?o:[o],r=i.join()+n.string+(t._measureText?"-spriting":"");if(!H.has(r)){t.save(),t.font=n.string;const e=i.length;let o=0;for(let n=0;n<e;n++){const e=i[n];o=Math.max(o,t.measureText(e).width)}t.restore();const s=e*n.lineHeight;H.set(r,{width:o,height:s})}return H.get(r)}function B(t,e,o){const{x:n,y:i,width:r,height:s}=e;t.save(),z(t,o);const a=_(t,o);t.fillStyle=o.backgroundColor,t.beginPath(),R(t,{x:n,y:i,w:r,h:s,radius:v(X(V(o.cornerRadius,o.borderRadius)),0,Math.min(r,s)/2)}),t.closePath(),t.fill(),a&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore()}function $(t,e,o){const n=o.content;if(N(n))return void t.drawImage(n,e.x,e.y,e.width,e.height);const i=E(n)?n:[n],r=Y(o.font),s=r.lineHeight,a=function(t,e){const{x:o,width:n}=t,i=e.textAlign;return"center"===i?o+n/2:"end"===i||"right"===i?o+n:o}(e,o),d=e.y+s/2;t.font=r.string,t.textBaseline="middle",t.textAlign=o.textAlign,t.fillStyle=o.color,i.forEach(((e,o)=>t.fillText(e,a,d+o*s)))}function F(t){const{x:e,y:o,width:n,height:i}=t;return{x:e+n/2,y:o+i/2}}const{isFinite:J}=n.default.helpers;function q(t,e,o){return e="number"==typeof e?e:t.parse(e),J(e)?t.getPixelForValue(e):o}function U(t,e){if(t){const o=q(t,e.min,e.start),n=q(t,e.max,e.end);return{start:Math.min(o,n),end:Math.max(o,n)}}return{start:e.start,end:e.end}}function G(t,e){const{chartArea:o,scales:n}=t,i=n[e.xScaleID],r=n[e.yScaleID];let s=o.width/2,a=o.height/2;return i&&(s=q(i,e.xValue,s)),r&&(a=q(r,e.yValue,a)),{x:s,y:a}}function K(t,e){const o=t.scales[e.xScaleID],n=t.scales[e.yScaleID];let{top:i,left:r,bottom:s,right:a}=t.chartArea;if(!o&&!n)return{};const d=U(o,{min:e.xMin,max:e.xMax,start:r,end:a});r=d.start,a=d.end;const l=U(n,{min:e.yMin,max:e.yMax,start:i,end:s});return i=l.start,s=l.end,{x:r,y:i,x2:a,y2:s,width:a-r,height:s-i}}function Q(t,e){if(!T(e)){const o=K(t,e),n=F(o);let i=e.radius;return i&&!isNaN(i)||(i=Math.min(o.width,o.height)/2,e.radius=i),{x:n.x+e.xAdjust,y:n.y+e.yAdjust,width:2*i,height:2*i}}return function(t,e){const o=G(t,e);return{x:o.x+e.xAdjust,y:o.y+e.yAdjust,width:2*e.radius,height:2*e.radius}}(t,e)}const{toPadding:Z}=n.default.helpers;class tt extends t.Element{inRange(t,e,o){return M(t,e,this.getProps(["x","y","width","height"],o),this.options.borderWidth)}getCenterPoint(t){return F(this.getProps(["x","y","width","height"],t))}draw(t){t.save(),B(t,this,this.options),t.restore()}drawLabel(t){const{x:e,y:o,width:n,height:i,options:r}=this,{label:s,borderWidth:a}=r,d=a/2,l=W(s.position),h=Z(s.padding),c=L(t,s),u={x:et(this,c,l,h),y:ot(this,c,l,h),width:c.width,height:c.height};t.save(),t.beginPath(),t.rect(e+d+h.left,o+d+h.top,n-a-h.width,i-a-h.height),t.clip(),$(t,u,s),t.restore()}resolveElementProperties(t,e){return K(t,e)}}function et(t,e,o,n){const{x:i,x2:r,width:s,options:a}=t,{xAdjust:d,borderWidth:l}=a.label;return nt({start:i,end:r,size:s},{position:o.x,padding:{start:n.left,end:n.right},adjust:d,borderWidth:l,size:e.width})}function ot(t,e,o,n){const{y:i,y2:r,height:s,options:a}=t,{yAdjust:d,borderWidth:l}=a.label;return nt({start:i,end:r,size:s},{position:o.y,padding:{start:n.top,end:n.bottom},adjust:d,borderWidth:l,size:e.height})}function nt(t,e){const{start:o,end:n}=t,{position:i,padding:{start:r,end:s},adjust:a,borderWidth:d}=e;return o+d/2+a+r+A(n-d-o-r-s-e.size,i)}tt.id="boxAnnotation",tt.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:1,cornerRadius:void 0,display:!0,label:{borderWidth:void 0,color:"black",content:null,drawTime:void 0,enabled:!1,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,padding:6,position:"center",textAlign:"start",xAdjust:0,yAdjust:0,width:void 0},shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},tt.defaultRoutes={borderColor:"color",backgroundColor:"color"},tt.descriptors={label:{_fallback:!0}};const{PI:it,toRadians:rt,toPadding:st}=n.default.helpers,at=(t,e,o)=>({x:t.x+o*(e.x-t.x),y:t.y+o*(e.y-t.y)}),dt=(t,e,o)=>at(e,o,Math.abs((t-e.y)/(o.y-e.y))).x,lt=(t,e,o)=>at(e,o,Math.abs((t-e.x)/(o.x-e.x))).y,ht=t=>t*t;function ct({x:t,y:e,x2:o,y2:n},{top:i,right:r,bottom:s,left:a}){return!(t<a&&o<a||t>r&&o>r||e<i&&n<i||e>s&&n>s)}function ut({x:t,y:e},o,{top:n,right:i,bottom:r,left:s}){return t<s&&(e=lt(s,{x:t,y:e},o),t=s),t>i&&(e=lt(i,{x:t,y:e},o),t=i),e<n&&(t=dt(n,{x:t,y:e},o),e=n),e>r&&(t=dt(r,{x:t,y:e},o),e=r),{x:t,y:e}}class ft extends t.Element{intersects(t,e,o=.001,n){const{x:i,y:r,x2:s,y2:a}=this.getProps(["x","y","x2","y2"],n),d=s-i,l=a-r,h=ht(d)+ht(l),c=0===h?-1:((t-i)*d+(e-r)*l)/h;let u,f;return c<0?(u=i,f=r):c>1?(u=s,f=a):(u=i+c*d,f=r+c*l),ht(t-u)+ht(e-f)<o}labelIsVisible(t,e){const o=this.options.label;return!(!o||!o.enabled)&&(!e||ct(this.getProps(["x","y","x2","y2"],t),e))}isOnLabel(t,e,o){if(!this.labelIsVisible(o))return!1;const{labelX:n,labelY:i,labelWidth:r,labelHeight:s,labelRotation:a}=this.getProps(["labelX","labelY","labelWidth","labelHeight","labelRotation"],o),{x:d,y:l}=function(t,e,o){const n=Math.cos(o),i=Math.sin(o),r=e.x,s=e.y;return{x:r+n*(t.x-r)-i*(t.y-s),y:s+i*(t.x-r)+n*(t.y-s)}}({x:t,y:e},{x:n,y:i},-a),h=this.options.label.borderWidth/2||0,c=r/2+h,u=s/2+h;return d>=n-c&&d<=n+c&&l>=i-u&&l<=i+u}inRange(t,e,o){const n=ht(this.options.borderWidth/2);return this.intersects(t,e,n,o)||this.isOnLabel(t,e,o)}getCenterPoint(){return{x:(this.x2+this.x)/2,y:(this.y2+this.y)/2}}draw(t){const{x:e,y:o,x2:n,y2:i,options:r}=this;if(t.save(),!_(t,r))return t.restore();z(t,r);const s=Math.atan2(i-o,n-e),a=Math.sqrt(Math.pow(n-e,2)+Math.pow(i-o,2)),{startOpts:d,endOpts:l,startAdjust:h,endAdjust:c}=function(t){const e=t.options,o=e.arrowHeads&&e.arrowHeads.start,n=e.arrowHeads&&e.arrowHeads.end;return{startOpts:o,endOpts:n,startAdjust:yt(t,o),endAdjust:yt(t,n)}}(this);t.translate(e,o),t.rotate(s),t.beginPath(),t.moveTo(0+h,0),t.lineTo(a-c,0),t.shadowColor=r.borderShadowColor,t.stroke(),gt(t,0,h,d),gt(t,a,-c,l),t.restore()}drawLabel(t,e){if(!this.labelIsVisible(!1,e))return;const{labelX:o,labelY:n,labelWidth:i,labelHeight:r,labelRotation:s,labelPadding:a,labelTextSize:d,options:{label:l}}=this;t.save(),t.translate(o,n),t.rotate(s);B(t,{x:-i/2,y:-r/2,width:i,height:r},l);$(t,{x:-i/2+a.left+l.borderWidth/2,y:-r/2+a.top+l.borderWidth/2,width:d.width,height:d.height},l),t.restore()}resolveElementProperties(t,e){const o=t.scales[e.scaleID];let n,i,{top:r,left:s,bottom:a,right:d}=t.chartArea;if(o)n=q(o,e.value,NaN),i=q(o,e.endValue,n),o.isHorizontal()?(s=n,d=i):(r=n,a=i);else{const o=t.scales[e.xScaleID],n=t.scales[e.yScaleID];o&&(s=q(o,e.xMin,s),d=q(o,e.xMax,d)),n&&(r=q(n,e.yMin,r),a=q(n,e.yMax,a))}const l=ct({x:s,y:r,x2:d,y2:a},t.chartArea)?function(t,e,o){const{x:n,y:i}=ut(t,e,o),{x:r,y:s}=ut(e,t,o);return{x:n,y:i,x2:r,y2:s,width:Math.abs(r-n),height:Math.abs(s-i)}}({x:s,y:r},{x:d,y:a},t.chartArea):{x:s,y:r,x2:d,y2:a,width:Math.abs(d-s),height:Math.abs(a-r)},h=e.label;return h&&h.content?function(t,e,o){const{padding:n,xPadding:i,yPadding:r,borderWidth:s}=o,a=function(t,e,o){let n=t;(e||o)&&(n={x:e||6,y:o||6});return st(n)}(n,i,r),d=L(e.ctx,o),l=d.width+a.width+s,h=d.height+a.height+s,c=function(t,e,o,n){const{width:i,height:r,padding:s}=o,{xAdjust:a,yAdjust:d}=e,l={x:t.x,y:t.y},h={x:t.x2,y:t.y2},c="auto"===e.rotation?function(t){const{x:e,y:o,x2:n,y2:i}=t,r=Math.atan2(i-o,n-e);return r>it/2?r-it:r<it/-2?r+it:r}(t):rt(e.rotation),u=function(t,e,o){const n=Math.cos(o),i=Math.sin(o);return{w:Math.abs(t*n)+Math.abs(e*i),h:Math.abs(t*i)+Math.abs(e*n)}}(i,r,c),f=function(t,e,o,n){let i;const r=function(t,e){const{x:o,x2:n,y:i,y2:r}=t,s=Math.min(i,r)-e.top,a=Math.min(o,n)-e.left,d=e.bottom-Math.max(i,r),l=e.right-Math.max(o,n);return{x:Math.min(a,l),y:Math.min(s,d),dx:a<=l?1:-1,dy:s<=d?1:-1}}(t,n);i="start"===e.position?pt({w:t.x2-t.x,h:t.y2-t.y},o,e,r):"end"===e.position?1-pt({w:t.x-t.x2,h:t.y-t.y2},o,e,r):A(1,e.position);return i}(t,e,{labelSize:u,padding:s},n),b=at(l,h,f),p={size:u.w,min:n.left,max:n.right,padding:s.left},x={size:u.h,min:n.top,max:n.bottom,padding:s.top};return{x:xt(b.x,p)+a,y:xt(b.y,x)+d,width:i,height:r,rotation:c}}(t,o,{width:l,height:h,padding:a},e.chartArea);return t.labelX=c.x,t.labelY=c.y,t.labelWidth=c.width,t.labelHeight=c.height,t.labelRotation=c.rotation,t.labelPadding=a,t.labelTextSize=d,t}(l,t,h):l}}ft.id="lineAnnotation";const bt={backgroundColor:void 0,backgroundShadowColor:void 0,borderColor:void 0,borderDash:void 0,borderDashOffset:void 0,borderShadowColor:void 0,borderWidth:void 0,enabled:void 0,fill:void 0,length:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,width:void 0};function pt(t,e,o,n){const{labelSize:i,padding:r}=e,s=t.w*n.dx,a=t.h*n.dy,d=s>0&&(i.w/2+r.left-n.x)/s,l=a>0&&(i.h/2+r.top-n.y)/a;return m(Math.max(d,l),0,.25)}function xt(t,e){const{size:o,min:n,max:i,padding:r}=e,s=o/2;return o>i-n?(i+n)/2:(n>=t-r-s&&(t=n+r+s),i<=t+r+s&&(t=i-r-s),t)}function yt(t,e){if(!e||!e.enabled)return 0;const{length:o,width:n}=e,i=t.options.borderWidth/2,r={x:o,y:n+i},s={x:0,y:i};return Math.abs(dt(0,r,s))}function gt(t,e,o,n){if(!n||!n.enabled)return;const{length:i,width:r,fill:s,backgroundColor:a,borderColor:d}=n,l=Math.abs(e-i)+o;t.beginPath(),z(t,n),_(t,n),t.moveTo(l,-r),t.lineTo(e+o,0),t.lineTo(l,r),!0===s?(t.fillStyle=a||d,t.closePath(),t.fill(),t.shadowColor="transparent"):t.shadowColor=n.borderShadowColor,t.stroke()}ft.defaults={adjustScaleRange:!0,arrowHeads:{enabled:!1,end:Object.assign({},bt),fill:!1,length:12,start:Object.assign({},bt),width:6},borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:2,display:!0,endValue:void 0,label:{backgroundColor:"rgba(0,0,0,0.8)",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderColor:"black",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:6,borderShadowColor:"transparent",borderWidth:0,color:"#fff",content:null,cornerRadius:void 0,drawTime:void 0,enabled:!1,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",width:void 0,xAdjust:0,xPadding:void 0,yAdjust:0,yPadding:void 0},scaleID:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,value:void 0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},ft.descriptors={arrowHeads:{start:{_fallback:!0},end:{_fallback:!0},_fallback:!0}},ft.defaultRoutes={borderColor:"color"};const{PI:wt,toRadians:mt}=n.default.helpers;class vt extends t.Element{inRange(t,e,o){return function(t,e,o,n){const{width:i,height:r}=e,s=e.getCenterPoint(!0),a=i/2,d=r/2;if(a<=0||d<=0)return!1;const l=mt(o||0),h=n/2||0,c=Math.cos(l),u=Math.sin(l),f=Math.pow(c*(t.x-s.x)+u*(t.y-s.y),2),b=Math.pow(u*(t.x-s.x)-c*(t.y-s.y),2);return f/Math.pow(a+h,2)+b/Math.pow(d+h,2)<=1.0001}({x:t,y:e},this.getProps(["width","height"],o),this.options.rotation,this.options.borderWidth)}getCenterPoint(t){return F(this.getProps(["x","y","width","height"],t))}draw(t){const{width:e,height:o,options:n}=this,i=this.getCenterPoint();t.save(),t.translate(i.x,i.y),n.rotation&&t.rotate(mt(n.rotation)),z(t,this.options),t.beginPath(),t.fillStyle=n.backgroundColor;const r=_(t,n);t.ellipse(0,0,o/2,e/2,wt/2,0,2*wt),t.fill(),r&&(t.shadowColor=n.borderShadowColor,t.stroke()),t.restore()}resolveElementProperties(t,e){return K(t,e)}}vt.id="ellipseAnnotation",vt.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},vt.defaultRoutes={borderColor:"color",backgroundColor:"color"};const{color:Mt,toPadding:St}=n.default.helpers;class Ct extends t.Element{inRange(t,e,o){return M(t,e,this.getProps(["x","y","width","height"],o),this.options.borderWidth)}getCenterPoint(t){return F(this.getProps(["x","y","width","height"],t))}draw(t){if(!this.options.content)return;const{labelX:e,labelY:o,labelWidth:n,labelHeight:i,options:r}=this;!function(t,e){const{pointX:o,pointY:n,calloutPosition:i,options:r}=e;if(!i)return;const s=r.callout;t.save(),t.beginPath();if(!_(t,s))return t.restore();const{separatorStart:a,separatorEnd:d}=function(t,e){const{x:o,y:n,width:i,height:r}=t,s=function(t,e){const{width:o,height:n,options:i}=t,r=i.callout.margin+i.borderWidth/2;if("right"===e)return o+r;if("bottom"===e)return n+r;return-r}(t,e);let a,d;"left"===e||"right"===e?(a={x:o+s,y:n},d={x:a.x,y:a.y+r}):(a={x:o,y:n+s},d={x:a.x+i,y:a.y});return{separatorStart:a,separatorEnd:d}}(e,i),{sideStart:l,sideEnd:h}=function(t,e,o){const{y:n,width:i,height:r,options:s}=t,a=s.callout.start,d=function(t,e){const o=e.side;if("left"===t||"top"===t)return-o;return o}(e,s.callout);let l,h;"left"===e||"right"===e?(l={x:o.x,y:n+I(r,a)},h={x:l.x+d,y:l.y}):(l={x:o.x+I(i,a),y:o.y},h={x:l.x,y:l.y+d});return{sideStart:l,sideEnd:h}}(e,i,a);(s.margin>0||0===r.borderWidth)&&(t.moveTo(a.x,a.y),t.lineTo(d.x,d.y));t.moveTo(l.x,l.y),t.lineTo(h.x,h.y),t.lineTo(o,n),t.stroke(),t.restore()}(t,this),this.boxVisible&&B(t,this,r),$(t,{x:e,y:o,width:n,height:i},r)}resolveElementProperties(t,e){const o=T(e)?G(t,e):F(K(t,e)),n=St(e.padding),i=L(t.ctx,e),r=function(t,e,o,n){const i=e.width+n.width+o.borderWidth,r=e.height+n.height+o.borderWidth,s=W(o.position);return{x:Dt(t.x,i,o.xAdjust,s.x),y:Dt(t.y,r,o.yAdjust,s.y),width:i,height:r}}(o,i,e,n),s=Mt(e.backgroundColor),a={boxVisible:e.borderWidth>0||s&&s.valid&&s.rgb.a>0,pointX:o.x,pointY:o.y,...r,labelX:r.x+n.left+e.borderWidth/2,labelY:r.y+n.top+e.borderWidth/2,labelWidth:i.width,labelHeight:i.height};return a.calloutPosition=e.callout.enabled&&function(t,e){const o=e.position;if("left"===o||"right"===o||"top"===o||"bottom"===o)return o;return function(t,e){const{x:o,y:n,width:i,height:r,pointX:s,pointY:a}=t,{margin:d,side:l}=e,h=d+l;if(s<o-h)return"left";if(s>o+i+h)return"right";if(a<n-h)return"top";if(a>n+r+h)return"bottom"}(t,e)}(a,e.callout),a}}function Dt(t,e,o=0,n){return t-A(e,n)+o}Ct.id="labelAnnotation",Ct.defaults={adjustScaleRange:!0,backgroundColor:"transparent",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:0,callout:{borderCapStyle:"butt",borderColor:void 0,borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:1,enabled:!1,margin:5,position:"auto",side:5,start:"50%"},color:"black",content:null,display:!0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:void 0},height:void 0,padding:6,position:"center",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",width:void 0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},Ct.defaultRoutes={borderColor:"color"};const{drawPoint:kt}=n.default.helpers;class Pt extends t.Element{inRange(t,e,o){const{width:n}=this.getProps(["width"],o);return function(t,e,o,n){if(!t||!e||o<=0)return!1;const i=n/2||0;return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(o+i,2)}({x:t,y:e},this.getCenterPoint(o),n/2,this.options.borderWidth)}getCenterPoint(t){return S(this,t)}draw(t){const e=this.options,o=e.borderWidth;if(e.radius<.1)return;t.save(),t.fillStyle=e.backgroundColor,z(t,e);const n=_(t,e);e.borderWidth=0,kt(t,e,this.x,this.y),n&&!N(e.pointStyle)&&(t.shadowColor=e.borderShadowColor,t.stroke()),t.restore(),e.borderWidth=o}resolveElementProperties(t,e){return Q(t,e)}}Pt.id="pointAnnotation",Pt.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,pointStyle:"circle",radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},Pt.defaultRoutes={borderColor:"color",backgroundColor:"color"};const{PI:Ot,RAD_PER_DEG:jt}=n.default.helpers;class At extends t.Element{inRange(t,e,o){return this.options.radius>=.1&&this.elements.length>1&&function(t,e,o,n){let i=!1,r=t[t.length-1].getProps(["bX","bY"],n);for(const s of t){const t=s.getProps(["bX","bY"],n);t.bY>o!=r.bY>o&&e<(r.bX-t.bX)*(o-t.bY)/(r.bY-t.bY)+t.bX&&(i=!i),r=t}return i}(this.elements,t,e,o)}getCenterPoint(t){return S(this,t)}draw(t){const{elements:e,options:o}=this;t.save(),t.beginPath(),t.fillStyle=o.backgroundColor,z(t,o);const n=_(t,o);let i=!0;for(const o of e)i?(t.moveTo(o.x,o.y),i=!1):t.lineTo(o.x,o.y);t.closePath(),t.fill(),n&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore()}resolveElementProperties(t,e){const{x:o,y:n,width:i,height:r}=Q(t,e),{sides:s,radius:a,rotation:d,borderWidth:l}=e,h=l/2,c=[],u=2*Ot/s;let f=d*jt;for(let t=0;t<s;t++,f+=u){const t=Math.sin(f),e=Math.cos(f);c.push({type:"point",optionScope:"point",properties:{x:o+t*a,y:n-e*a,bX:o+t*(a+h),bY:n-e*(a+h)}})}return{x:o,y:n,width:i,height:r,elements:c,initProperties:{x:o,y:n}}}}At.id="polygonAnnotation",At.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderShadowColor:"transparent",borderWidth:1,display:!0,point:{radius:0},radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,sides:3,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},At.defaultRoutes={borderColor:"color",backgroundColor:"color"};const It={box:tt,ellipse:vt,label:Ct,line:ft,point:Pt,polygon:At};Object.keys(It).forEach((e=>{t.defaults.describe(`elements.${It[e].id}`,{_fallback:"plugins.annotation"})}));const{clipArea:Wt,unclipArea:Tt,isObject:Rt,isArray:Et}=n.default.helpers,Yt=new Map;var Xt={id:"annotation",version:"1.2.2",afterRegister(){t.Chart.register(It),function(t,e,o,n=!0){const i=o.split(".");let r=0;for(const s of e.split(".")){const a=i[r++];if(parseInt(s,10)<parseInt(a,10))break;if(C(a,s)){if(n)throw new Error(`${t} v${o} is not supported. v${e} or newer is required.`);return!1}}return!0}("chart.js","3.7",t.Chart.version,!1)||(console.warn("chartjs-plugin-annotation has known issues with chart.js versions prior to 3.7, please consider upgrading."),t.Chart.defaults.set("elements.lineAnnotation",{callout:{},font:{},padding:6}))},afterUnregister(){t.Chart.unregister(It)},beforeInit(t){Yt.set(t,{annotations:[],elements:[],visibleElements:[],listeners:{},listened:!1,moveListened:!1})},beforeUpdate(t,e,o){const n=Yt.get(t).annotations=[];let i=o.annotations;Rt(i)?Object.keys(i).forEach((t=>{const e=i[t];Rt(e)&&(e.id=t,n.push(e))})):Et(i)&&n.push(...i),function(t,e){for(const o of t)g(o,e)}(n,t.scales)},afterDataLimits(t,e){const o=Yt.get(t);x(0,e.scale,o.annotations.filter((t=>t.display&&t.adjustScaleRange)))},afterUpdate(e,o,n){const i=Yt.get(e);!function(t,e,o){e.listened=!1,e.moveListened=!1,l.forEach((t=>{"function"==typeof o[t]?(e.listened=!0,e.listeners[t]=o[t]):r(e.listeners[t])&&delete e.listeners[t]})),d.forEach((t=>{"function"==typeof o[t]&&(e.moveListened=!0)})),e.listened&&e.moveListened||e.annotations.forEach((t=>{e.listened||a.forEach((o=>{"function"==typeof t[o]&&(e.listened=!0)})),e.moveListened||d.forEach((o=>{"function"==typeof t[o]&&(e.listened=!0,e.moveListened=!0)}))}))}(0,i,n),function(e,o,n,i){const r=function(e,o,n){if("reset"===n||"none"===n||"resize"===n)return Vt;return new t.Animations(e,o)}(e,n.animations,i),s=o.annotations,a=function(t,e){const o=e.length,n=t.length;if(n<o){const e=o-n;t.splice(n,0,...new Array(e))}else n>o&&t.splice(o,n-o);return t}(o.elements,s);for(let t=0;t<s.length;t++){const o=s[t],n=_t(a,t,o.type),i=o.setContext(Bt(e,n,o)),d=zt(i),l=n.resolveElementProperties(e,d);l.skip=isNaN(l.x)||isNaN(l.y),l.options=d,"elements"in l&&(Nt(n,l,i,r),delete l.elements),r.update(n,l)}}(e,i,n,o.mode),i.visibleElements=i.elements.filter((t=>!t.skip&&t.options.display))},beforeDatasetsDraw(t,e,o){$t(t,"beforeDatasetsDraw",o.clip)},afterDatasetsDraw(t,e,o){$t(t,"afterDatasetsDraw",o.clip)},beforeDraw(t,e,o){$t(t,"beforeDraw",o.clip)},afterDraw(t,e,o){$t(t,"afterDraw",o.clip)},beforeEvent(t,e,o){h(Yt.get(t),e.event,o)},destroy(t){Yt.delete(t)},_getState:t=>Yt.get(t),defaults:{animations:{numbers:{properties:["x","y","x2","y2","width","height","pointX","pointY","labelX","labelY","labelWidth","labelHeight","radius"],type:"number"}},clip:!0,dblClickSpeed:350,drawTime:"afterDatasetsDraw",label:{drawTime:null}},descriptors:{_indexable:!1,_scriptable:t=>!l.includes(t),annotations:{_allKeys:!1,_fallback:(t,e)=>`elements.${It[Ht(e.type)].id}`}},additionalOptionScopes:[""]};const Vt={update:Object.assign};function Ht(t="line"){return It[t]?t:(console.warn(`Unknown annotation type: '${t}', defaulting to 'line'`),"line")}function Nt(t,{elements:e,initProperties:o},n,i){const r=t.elements||(t.elements=[]);r.length=e.length;for(let t=0;t<e.length;t++){const s=e[t],a=s.properties,d=_t(r,t,s.type,o),l=n[s.optionScope].override(s);a.options=zt(l),i.update(d,a)}}function _t(t,e,o,n){const i=It[Ht(o)];let r=t[e];return r&&r instanceof i||(r=t[e]=new i,Rt(n)&&Object.assign(r,n)),r}function zt(t){const e=It[Ht(t.type)],o={};o.id=t.id,o.type=t.type,o.drawTime=t.drawTime,Object.assign(o,Lt(t,e.defaults),Lt(t,e.defaultRoutes));for(const e of l)o[e]=t[e];return o}function Lt(t,e){const o={};for(const n of Object.keys(e)){const i=e[n],r=t[n];o[n]=Rt(i)?Lt(r,i):r}return o}function Bt(t,e,o){return e.$context||(e.$context=Object.assign(Object.create(t.getContext()),{element:e,id:o.id,type:"annotation"}))}function $t(t,e,o){const{ctx:n,chartArea:i}=t,{visibleElements:r}=Yt.get(t);o&&Wt(n,i),Ft(n,r,e),function(t,e,o){for(const n of e)Et(n.elements)&&Ft(t,n.elements,o)}(n,r,e),o&&Tt(n),r.forEach((t=>{if(!("drawLabel"in t))return;const o=t.options.label;o&&o.enabled&&o.content&&(o.drawTime||t.options.drawTime)===e&&t.drawLabel(n,i)}))}function Ft(t,e,o){for(const n of e)n.options.drawTime===o&&n.draw(t)}return t.Chart.register(Xt),Xt}));
