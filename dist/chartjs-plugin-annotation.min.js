/*!
* chartjs-plugin-annotation v1.2.2
* https://www.chartjs.org/chartjs-plugin-annotation/index
 * (c) 2022 chartjs-plugin-annotation Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js-v3"),require("chart.js/helpers"),require("chart.js"),require("canvas")):"function"==typeof define&&define.amd?define(["chart.js-v3","chart.js/helpers","chart.js","canvas"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["chartjs-plugin-annotation"]=e(t.ChartJsV3,t.Chart.helpers,t.Chart,t.canvas)}(this,(function(t,e,o,n){"use strict";function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=i(t);const{distanceBetweenPoints:s,defined:a,callback:d}=r.default.helpers,l=["click","dblclick"],h=["enter","leave"],c=l.concat(h);function u(t,e,o){if(t.listened)switch(e.type){case"mousemove":case"mouseout":!function(t,e){if(!t.moveListened)return;let o;"mousemove"===e.type&&(o=b(t.elements,e));const n=t.hovered;t.hovered=o,function(t,e,o){const{previous:n,element:i}=e;n&&n!==i&&f(n.options.leave||t.listeners.leave,n,o);i&&i!==n&&f(i.options.enter||t.listeners.enter,i,o)}(t,{previous:n,element:o},e)}(t,e);break;case"click":!function(t,e,o){const n=t.listeners,i=b(t.elements,e);if(i){const t=i.options,r=t.dblclick||n.dblclick,s=t.click||n.click;i.clickTimeout?(clearTimeout(i.clickTimeout),delete i.clickTimeout,f(r,i,e)):r?i.clickTimeout=setTimeout((()=>{delete i.clickTimeout,f(s,i,e)}),o.dblClickSpeed):f(s,i,e)}}(t,e,o)}}function f(t,e,o){d(t,[e.$context,o])}function b(t,e){let o=Number.POSITIVE_INFINITY;return t.filter((t=>t.options.display&&t.inRange(e.x,e.y))).reduce(((t,n)=>{const i=n.getCenterPoint(),r=s(e,i);return r<o?(t=[n],o=r):r===o&&t.push(n),t}),[]).sort(((t,e)=>t._index-e._index)).slice(0,1)[0]}function p(t,o,n){const i=function(t,o){const n=t.axis,i=t.id,r=n+"ScaleID",s={min:e.valueOrDefault(t.min,Number.NEGATIVE_INFINITY),max:e.valueOrDefault(t.max,Number.POSITIVE_INFINITY)};for(const e of o)e.scaleID===i?g(e,t,["value","endValue"],s):e[r]===i&&g(e,t,[n+"Min",n+"Max",n+"Value"],s);return s}(o,n);let r=x(o,i,"min","suggestedMin");r=x(o,i,"max","suggestedMax")||r,r&&"function"==typeof o.handleTickRangeOptions&&o.handleTickRangeOptions()}function x(t,o,n,i){if(e.isFinite(o[n])&&!function(t,o,n){return e.defined(t[o])||e.defined(t[n])}(t.options,n,i)){const e=t[n]!==o[n];return t[n]=o[n],e}}function y(t,e){for(const o of["scaleID","xScaleID","yScaleID"])t[o]&&!e[t[o]]&&console.warn(`No scale found with id '${t[o]}' for annotation '${t.id}'`)}function g(t,o,n,i){for(const r of n){const n=t[r];if(e.defined(n)){const t=o.parse(n);i.min=Math.min(i.min,t),i.max=Math.max(i.max,t)}}}const w=(t,e,o)=>Math.min(o,Math.max(e,t));function m(t,e,o){for(const n of Object.keys(t))t[n]=w(t[n],e,o);return t}function v(t,e,{x:o,y:n,width:i,height:r},s){const a=s/2||0;return t>=o-a&&t<=o+i+a&&e>=n-a&&e<=n+r+a}function M(t,e){const{x:o,y:n}=t.getProps(["x","y"],e);return{x:o,y:n}}const S=(t,e)=>e>t||t.length>e.length&&t.substr(0,e.length)===e;const{isObject:C,valueOrDefault:D,defined:k}=r.default.helpers,P=t=>"string"==typeof t&&t.endsWith("%"),j=t=>w(parseFloat(t)/100,0,1);function O(t,e){return"start"===e?0:"end"===e?t:P(e)?j(e)*t:t/2}function A(t,e){return"number"==typeof e?e:P(e)?j(e)*t:t}function I(t){return C(t)?{x:D(t.x,"center"),y:D(t.y,"center")}:{x:t=D(t,"center"),y:t}}function W(t){return t&&(k(t.xValue)||k(t.yValue))}const{addRoundedRectPath:T,isArray:R,toFont:E,toTRBLCorners:Y,valueOrDefault:X}=r.default.helpers,V=new Map;function H(t){return t instanceof n.Image||t instanceof Image||t instanceof HTMLCanvasElement}function N(t,e){if(e&&e.borderWidth)return t.lineCap=e.borderCapStyle,t.setLineDash(e.borderDash),t.lineDashOffset=e.borderDashOffset,t.lineJoin=e.borderJoinStyle,t.lineWidth=e.borderWidth,t.strokeStyle=e.borderColor,!0}function _(t,e){t.shadowColor=e.backgroundShadowColor,t.shadowBlur=e.shadowBlur,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY}function z(t,e){const o=e.content;if(H(o))return{width:A(o.width,e.width),height:A(o.height,e.height)};const n=E(e.font),i=R(o)?o:[o],r=i.join()+n.string+(t._measureText?"-spriting":"");if(!V.has(r)){t.save(),t.font=n.string;const e=i.length;let o=0;for(let n=0;n<e;n++){const e=i[n];o=Math.max(o,t.measureText(e).width)}t.restore();const s=e*n.lineHeight;V.set(r,{width:o,height:s})}return V.get(r)}function L(t,e,o){const{x:n,y:i,width:r,height:s}=e;t.save(),_(t,o);const a=N(t,o);t.fillStyle=o.backgroundColor,t.beginPath(),T(t,{x:n,y:i,w:r,h:s,radius:m(Y(X(o.cornerRadius,o.borderRadius)),0,Math.min(r,s)/2)}),t.closePath(),t.fill(),a&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore()}function B(t,e,o){const n=o.content;if(H(n))return void t.drawImage(n,e.x,e.y,e.width,e.height);const i=R(n)?n:[n],r=E(o.font),s=r.lineHeight,a=function(t,e){const{x:o,width:n}=t,i=e.textAlign;return"center"===i?o+n/2:"end"===i||"right"===i?o+n:o}(e,o),d=e.y+s/2;t.font=r.string,t.textBaseline="middle",t.textAlign=o.textAlign,t.fillStyle=o.color,i.forEach(((e,o)=>t.fillText(e,a,d+o*s)))}function $(t){const{x:e,y:o,width:n,height:i}=t;return{x:e+n/2,y:o+i/2}}const{isFinite:F}=r.default.helpers;function J(t,e,o){return e="number"==typeof e?e:t.parse(e),F(e)?t.getPixelForValue(e):o}function q(t,e){if(t){const o=J(t,e.min,e.start),n=J(t,e.max,e.end);return{start:Math.min(o,n),end:Math.max(o,n)}}return{start:e.start,end:e.end}}function U(t,e){const{chartArea:o,scales:n}=t,i=n[e.xScaleID],r=n[e.yScaleID];let s=o.width/2,a=o.height/2;return i&&(s=J(i,e.xValue,s)),r&&(a=J(r,e.yValue,a)),{x:s,y:a}}function G(t,e){const o=t.scales[e.xScaleID],n=t.scales[e.yScaleID];let{top:i,left:r,bottom:s,right:a}=t.chartArea;if(!o&&!n)return{};const d=q(o,{min:e.xMin,max:e.xMax,start:r,end:a});r=d.start,a=d.end;const l=q(n,{min:e.yMin,max:e.yMax,start:i,end:s});return i=l.start,s=l.end,{x:r,y:i,x2:a,y2:s,width:a-r,height:s-i}}function K(t,e){if(!W(e)){const o=G(t,e),n=$(o);let i=e.radius;return i&&!isNaN(i)||(i=Math.min(o.width,o.height)/2,e.radius=i),{x:n.x+e.xAdjust,y:n.y+e.yAdjust,width:2*i,height:2*i}}return function(t,e){const o=U(t,e);return{x:o.x+e.xAdjust,y:o.y+e.yAdjust,width:2*e.radius,height:2*e.radius}}(t,e)}const{toPadding:Q}=r.default.helpers;class Z extends t.Element{inRange(t,e,o){return v(t,e,this.getProps(["x","y","width","height"],o),this.options.borderWidth)}getCenterPoint(t){return $(this.getProps(["x","y","width","height"],t))}draw(t){t.save(),L(t,this,this.options),t.restore()}drawLabel(t){const{x:e,y:o,width:n,height:i,options:r}=this,{label:s,borderWidth:a}=r,d=a/2,l=I(s.position),h=Q(s.padding),c=z(t,s),u={x:tt(this,c,l,h),y:et(this,c,l,h),width:c.width,height:c.height};t.save(),t.beginPath(),t.rect(e+d+h.left,o+d+h.top,n-a-h.width,i-a-h.height),t.clip(),B(t,u,s),t.restore()}resolveElementProperties(t,e){return G(t,e)}}function tt(t,e,o,n){const{x:i,x2:r,width:s,options:a}=t,{xAdjust:d,borderWidth:l}=a.label;return ot({start:i,end:r,size:s},{position:o.x,padding:{start:n.left,end:n.right},adjust:d,borderWidth:l,size:e.width})}function et(t,e,o,n){const{y:i,y2:r,height:s,options:a}=t,{yAdjust:d,borderWidth:l}=a.label;return ot({start:i,end:r,size:s},{position:o.y,padding:{start:n.top,end:n.bottom},adjust:d,borderWidth:l,size:e.height})}function ot(t,e){const{start:o,end:n}=t,{position:i,padding:{start:r,end:s},adjust:a,borderWidth:d}=e;return o+d/2+a+r+O(n-d-o-r-s-e.size,i)}Z.id="boxAnnotation",Z.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:1,cornerRadius:void 0,display:!0,label:{borderWidth:void 0,color:"black",content:null,drawTime:void 0,enabled:!1,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,padding:6,position:"center",textAlign:"start",xAdjust:0,yAdjust:0,width:void 0},shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},Z.defaultRoutes={borderColor:"color",backgroundColor:"color"},Z.descriptors={label:{_fallback:!0}};const{PI:nt,toRadians:it,toPadding:rt}=r.default.helpers,st=(t,e,o)=>({x:t.x+o*(e.x-t.x),y:t.y+o*(e.y-t.y)}),at=(t,e,o)=>st(e,o,Math.abs((t-e.y)/(o.y-e.y))).x,dt=(t,e,o)=>st(e,o,Math.abs((t-e.x)/(o.x-e.x))).y,lt=t=>t*t;function ht({x:t,y:e,x2:o,y2:n},{top:i,right:r,bottom:s,left:a}){return!(t<a&&o<a||t>r&&o>r||e<i&&n<i||e>s&&n>s)}function ct({x:t,y:e},o,{top:n,right:i,bottom:r,left:s}){return t<s&&(e=dt(s,{x:t,y:e},o),t=s),t>i&&(e=dt(i,{x:t,y:e},o),t=i),e<n&&(t=at(n,{x:t,y:e},o),e=n),e>r&&(t=at(r,{x:t,y:e},o),e=r),{x:t,y:e}}class ut extends t.Element{intersects(t,e,o=.001,n){const{x:i,y:r,x2:s,y2:a}=this.getProps(["x","y","x2","y2"],n),d=s-i,l=a-r,h=lt(d)+lt(l),c=0===h?-1:((t-i)*d+(e-r)*l)/h;let u,f;return c<0?(u=i,f=r):c>1?(u=s,f=a):(u=i+c*d,f=r+c*l),lt(t-u)+lt(e-f)<o}labelIsVisible(t,e){const o=this.options.label;return!(!o||!o.enabled)&&(!e||ht(this.getProps(["x","y","x2","y2"],t),e))}isOnLabel(t,e,o){if(!this.labelIsVisible(o))return!1;const{labelX:n,labelY:i,labelWidth:r,labelHeight:s,labelRotation:a}=this.getProps(["labelX","labelY","labelWidth","labelHeight","labelRotation"],o),{x:d,y:l}=function(t,e,o){const n=Math.cos(o),i=Math.sin(o),r=e.x,s=e.y;return{x:r+n*(t.x-r)-i*(t.y-s),y:s+i*(t.x-r)+n*(t.y-s)}}({x:t,y:e},{x:n,y:i},-a),h=this.options.label.borderWidth/2||0,c=r/2+h,u=s/2+h;return d>=n-c&&d<=n+c&&l>=i-u&&l<=i+u}inRange(t,e,o){const n=lt(this.options.borderWidth/2);return this.intersects(t,e,n,o)||this.isOnLabel(t,e,o)}getCenterPoint(){return{x:(this.x2+this.x)/2,y:(this.y2+this.y)/2}}draw(t){const{x:e,y:o,x2:n,y2:i,options:r}=this;if(t.save(),!N(t,r))return t.restore();_(t,r);const s=Math.atan2(i-o,n-e),a=Math.sqrt(Math.pow(n-e,2)+Math.pow(i-o,2)),{startOpts:d,endOpts:l,startAdjust:h,endAdjust:c}=function(t){const e=t.options,o=e.arrowHeads&&e.arrowHeads.start,n=e.arrowHeads&&e.arrowHeads.end;return{startOpts:o,endOpts:n,startAdjust:xt(t,o),endAdjust:xt(t,n)}}(this);t.translate(e,o),t.rotate(s),t.beginPath(),t.moveTo(0+h,0),t.lineTo(a-c,0),t.shadowColor=r.borderShadowColor,t.stroke(),yt(t,0,h,d),yt(t,a,-c,l),t.restore()}drawLabel(t,e){if(!this.labelIsVisible(!1,e))return;const{labelX:o,labelY:n,labelWidth:i,labelHeight:r,labelRotation:s,labelPadding:a,labelTextSize:d,options:{label:l}}=this;t.save(),t.translate(o,n),t.rotate(s);L(t,{x:-i/2,y:-r/2,width:i,height:r},l);B(t,{x:-i/2+a.left+l.borderWidth/2,y:-r/2+a.top+l.borderWidth/2,width:d.width,height:d.height},l),t.restore()}resolveElementProperties(t,e){const o=t.scales[e.scaleID];let n,i,{top:r,left:s,bottom:a,right:d}=t.chartArea;if(o)n=J(o,e.value,NaN),i=J(o,e.endValue,n),o.isHorizontal()?(s=n,d=i):(r=n,a=i);else{const o=t.scales[e.xScaleID],n=t.scales[e.yScaleID];o&&(s=J(o,e.xMin,s),d=J(o,e.xMax,d)),n&&(r=J(n,e.yMin,r),a=J(n,e.yMax,a))}const l=ht({x:s,y:r,x2:d,y2:a},t.chartArea)?function(t,e,o){const{x:n,y:i}=ct(t,e,o),{x:r,y:s}=ct(e,t,o);return{x:n,y:i,x2:r,y2:s,width:Math.abs(r-n),height:Math.abs(s-i)}}({x:s,y:r},{x:d,y:a},t.chartArea):{x:s,y:r,x2:d,y2:a,width:Math.abs(d-s),height:Math.abs(a-r)},h=e.label;return h&&h.content?function(t,e,o){const{padding:n,xPadding:i,yPadding:r,borderWidth:s}=o,a=function(t,e,o){let n=t;(e||o)&&(n={x:e||6,y:o||6});return rt(n)}(n,i,r),d=z(e.ctx,o),l=d.width+a.width+s,h=d.height+a.height+s,c=function(t,e,o,n){const{width:i,height:r,padding:s}=o,{xAdjust:a,yAdjust:d}=e,l={x:t.x,y:t.y},h={x:t.x2,y:t.y2},c="auto"===e.rotation?function(t){const{x:e,y:o,x2:n,y2:i}=t,r=Math.atan2(i-o,n-e);return r>nt/2?r-nt:r<nt/-2?r+nt:r}(t):it(e.rotation),u=function(t,e,o){const n=Math.cos(o),i=Math.sin(o);return{w:Math.abs(t*n)+Math.abs(e*i),h:Math.abs(t*i)+Math.abs(e*n)}}(i,r,c),f=function(t,e,o,n){let i;const r=function(t,e){const{x:o,x2:n,y:i,y2:r}=t,s=Math.min(i,r)-e.top,a=Math.min(o,n)-e.left,d=e.bottom-Math.max(i,r),l=e.right-Math.max(o,n);return{x:Math.min(a,l),y:Math.min(s,d),dx:a<=l?1:-1,dy:s<=d?1:-1}}(t,n);i="start"===e.position?bt({w:t.x2-t.x,h:t.y2-t.y},o,e,r):"end"===e.position?1-bt({w:t.x-t.x2,h:t.y-t.y2},o,e,r):O(1,e.position);return i}(t,e,{labelSize:u,padding:s},n),b=st(l,h,f),p={size:u.w,min:n.left,max:n.right,padding:s.left},x={size:u.h,min:n.top,max:n.bottom,padding:s.top};return{x:pt(b.x,p)+a,y:pt(b.y,x)+d,width:i,height:r,rotation:c}}(t,o,{width:l,height:h,padding:a},e.chartArea);return t.labelX=c.x,t.labelY=c.y,t.labelWidth=c.width,t.labelHeight=c.height,t.labelRotation=c.rotation,t.labelPadding=a,t.labelTextSize=d,t}(l,t,h):l}}ut.id="lineAnnotation";const ft={backgroundColor:void 0,backgroundShadowColor:void 0,borderColor:void 0,borderDash:void 0,borderDashOffset:void 0,borderShadowColor:void 0,borderWidth:void 0,enabled:void 0,fill:void 0,length:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,width:void 0};function bt(t,e,o,n){const{labelSize:i,padding:r}=e,s=t.w*n.dx,a=t.h*n.dy,d=s>0&&(i.w/2+r.left-n.x)/s,l=a>0&&(i.h/2+r.top-n.y)/a;return w(Math.max(d,l),0,.25)}function pt(t,e){const{size:o,min:n,max:i,padding:r}=e,s=o/2;return o>i-n?(i+n)/2:(n>=t-r-s&&(t=n+r+s),i<=t+r+s&&(t=i-r-s),t)}function xt(t,e){if(!e||!e.enabled)return 0;const{length:o,width:n}=e,i=t.options.borderWidth/2,r={x:o,y:n+i},s={x:0,y:i};return Math.abs(at(0,r,s))}function yt(t,e,o,n){if(!n||!n.enabled)return;const{length:i,width:r,fill:s,backgroundColor:a,borderColor:d}=n,l=Math.abs(e-i)+o;t.beginPath(),_(t,n),N(t,n),t.moveTo(l,-r),t.lineTo(e+o,0),t.lineTo(l,r),!0===s?(t.fillStyle=a||d,t.closePath(),t.fill(),t.shadowColor="transparent"):t.shadowColor=n.borderShadowColor,t.stroke()}ut.defaults={adjustScaleRange:!0,arrowHeads:{enabled:!1,end:Object.assign({},ft),fill:!1,length:12,start:Object.assign({},ft),width:6},borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:2,display:!0,endValue:void 0,label:{backgroundColor:"rgba(0,0,0,0.8)",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderColor:"black",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:6,borderShadowColor:"transparent",borderWidth:0,color:"#fff",content:null,cornerRadius:void 0,drawTime:void 0,enabled:!1,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",width:void 0,xAdjust:0,xPadding:void 0,yAdjust:0,yPadding:void 0},scaleID:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,value:void 0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},ut.descriptors={arrowHeads:{start:{_fallback:!0},end:{_fallback:!0},_fallback:!0}},ut.defaultRoutes={borderColor:"color"};const{PI:gt,toRadians:wt}=r.default.helpers;class mt extends t.Element{inRange(t,e,o){return function(t,e,o,n){const{width:i,height:r}=e,s=e.getCenterPoint(!0),a=i/2,d=r/2;if(a<=0||d<=0)return!1;const l=wt(o||0),h=n/2||0,c=Math.cos(l),u=Math.sin(l),f=Math.pow(c*(t.x-s.x)+u*(t.y-s.y),2),b=Math.pow(u*(t.x-s.x)-c*(t.y-s.y),2);return f/Math.pow(a+h,2)+b/Math.pow(d+h,2)<=1.0001}({x:t,y:e},this.getProps(["width","height"],o),this.options.rotation,this.options.borderWidth)}getCenterPoint(t){return $(this.getProps(["x","y","width","height"],t))}draw(t){const{width:e,height:o,options:n}=this,i=this.getCenterPoint();t.save(),t.translate(i.x,i.y),n.rotation&&t.rotate(wt(n.rotation)),_(t,this.options),t.beginPath(),t.fillStyle=n.backgroundColor;const r=N(t,n);t.ellipse(0,0,o/2,e/2,gt/2,0,2*gt),t.fill(),r&&(t.shadowColor=n.borderShadowColor,t.stroke()),t.restore()}resolveElementProperties(t,e){return G(t,e)}}mt.id="ellipseAnnotation",mt.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},mt.defaultRoutes={borderColor:"color",backgroundColor:"color"};class vt extends o.Element{inRange(t,e,o){return v(t,e,this.getProps(["x","y","width","height"],o),this.options.borderWidth)}getCenterPoint(t){return $(this.getProps(["x","y","width","height"],t))}draw(t){if(!this.options.content)return;const{labelX:e,labelY:o,labelWidth:n,labelHeight:i,options:r}=this;!function(t,e){const{pointX:o,pointY:n,calloutPosition:i,options:r}=e;if(!i)return;const s=r.callout;t.save(),t.beginPath();if(!N(t,s))return t.restore();const{separatorStart:a,separatorEnd:d}=function(t,e){const{x:o,y:n,width:i,height:r}=t,s=function(t,e){const{width:o,height:n,options:i}=t,r=i.callout.margin+i.borderWidth/2;if("right"===e)return o+r;if("bottom"===e)return n+r;return-r}(t,e);let a,d;"left"===e||"right"===e?(a={x:o+s,y:n},d={x:a.x,y:a.y+r}):(a={x:o,y:n+s},d={x:a.x+i,y:a.y});return{separatorStart:a,separatorEnd:d}}(e,i),{sideStart:l,sideEnd:h}=function(t,e,o){const{y:n,width:i,height:r,options:s}=t,a=s.callout.start,d=function(t,e){const o=e.side;if("left"===t||"top"===t)return-o;return o}(e,s.callout);let l,h;"left"===e||"right"===e?(l={x:o.x,y:n+A(r,a)},h={x:l.x+d,y:l.y}):(l={x:o.x+A(i,a),y:o.y},h={x:l.x,y:l.y+d});return{sideStart:l,sideEnd:h}}(e,i,a);(s.margin>0||0===r.borderWidth)&&(t.moveTo(a.x,a.y),t.lineTo(d.x,d.y));t.moveTo(l.x,l.y),t.lineTo(h.x,h.y),t.lineTo(o,n),t.stroke(),t.restore()}(t,this),this.boxVisible&&L(t,this,r),B(t,{x:e,y:o,width:n,height:i},r)}resolveElementProperties(t,o){const n=W(o)?U(t,o):$(G(t,o)),i=e.toPadding(o.padding),r=z(t.ctx,o),s=function(t,e,o,n){const i=e.width+n.width+o.borderWidth,r=e.height+n.height+o.borderWidth,s=I(o.position);return{x:Mt(t.x,i,o.xAdjust,s.x),y:Mt(t.y,r,o.yAdjust,s.y),width:i,height:r}}(n,r,o,i),a=e.color(o.backgroundColor),d={boxVisible:o.borderWidth>0||a&&a.valid&&a.rgb.a>0,pointX:n.x,pointY:n.y,...s,labelX:s.x+i.left+o.borderWidth/2,labelY:s.y+i.top+o.borderWidth/2,labelWidth:r.width,labelHeight:r.height};return d.calloutPosition=o.callout.enabled&&function(t,e){const o=e.position;if("left"===o||"right"===o||"top"===o||"bottom"===o)return o;return function(t,e){const{x:o,y:n,width:i,height:r,pointX:s,pointY:a}=t,{margin:d,side:l}=e,h=d+l;if(s<o-h)return"left";if(s>o+i+h)return"right";if(a<n-h)return"top";if(a>n+r+h)return"bottom"}(t,e)}(d,o.callout),d}}function Mt(t,e,o=0,n){return t-O(e,n)+o}vt.id="labelAnnotation",vt.defaults={adjustScaleRange:!0,backgroundColor:"transparent",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:0,callout:{borderCapStyle:"butt",borderColor:void 0,borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:1,enabled:!1,margin:5,position:"auto",side:5,start:"50%"},color:"black",content:null,display:!0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:void 0},height:void 0,padding:6,position:"center",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",width:void 0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},vt.defaultRoutes={borderColor:"color"};const{drawPoint:St}=r.default.helpers;class Ct extends t.Element{inRange(t,e,o){const{width:n}=this.getProps(["width"],o);return function(t,e,o,n){if(!t||!e||o<=0)return!1;const i=n/2||0;return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(o+i,2)}({x:t,y:e},this.getCenterPoint(o),n/2,this.options.borderWidth)}getCenterPoint(t){return M(this,t)}draw(t){const e=this.options,o=e.borderWidth;if(e.radius<.1)return;t.save(),t.fillStyle=e.backgroundColor,_(t,e);const n=N(t,e);e.borderWidth=0,St(t,e,this.x,this.y),n&&!H(e.pointStyle)&&(t.shadowColor=e.borderShadowColor,t.stroke()),t.restore(),e.borderWidth=o}resolveElementProperties(t,e){return K(t,e)}}Ct.id="pointAnnotation",Ct.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,pointStyle:"circle",radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},Ct.defaultRoutes={borderColor:"color",backgroundColor:"color"};class Dt extends o.Element{inRange(t,e,o){return this.options.radius>=.1&&this.elements.length>1&&function(t,e,o,n){let i=!1,r=t[t.length-1].getProps(["bX","bY"],n);for(const s of t){const t=s.getProps(["bX","bY"],n);t.bY>o!=r.bY>o&&e<(r.bX-t.bX)*(o-t.bY)/(r.bY-t.bY)+t.bX&&(i=!i),r=t}return i}(this.elements,t,e,o)}getCenterPoint(t){return M(this,t)}draw(t){const{elements:e,options:o}=this;t.save(),t.beginPath(),t.fillStyle=o.backgroundColor,_(t,o);const n=N(t,o);let i=!0;for(const o of e)i?(t.moveTo(o.x,o.y),i=!1):t.lineTo(o.x,o.y);t.closePath(),t.fill(),n&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore()}resolveElementProperties(t,o){const{x:n,y:i,width:r,height:s}=K(t,o),{sides:a,radius:d,rotation:l,borderWidth:h}=o,c=h/2,u=[],f=2*e.PI/a;let b=l*e.RAD_PER_DEG;for(let t=0;t<a;t++,b+=f){const t=Math.sin(b),e=Math.cos(b);u.push({type:"point",optionScope:"point",properties:{x:n+t*d,y:i-e*d,bX:n+t*(d+c),bY:i-e*(d+c)}})}return{x:n,y:i,width:r,height:s,elements:u,initProperties:{x:n,y:i}}}}Dt.id="polygonAnnotation",Dt.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderShadowColor:"transparent",borderWidth:1,display:!0,point:{radius:0},radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,sides:3,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},Dt.defaultRoutes={borderColor:"color",backgroundColor:"color"};const kt={box:Z,ellipse:mt,label:vt,line:ut,point:Ct,polygon:Dt};Object.keys(kt).forEach((t=>{o.defaults.describe(`elements.${kt[t].id}`,{_fallback:"plugins.annotation"})}));const{clipArea:Pt,unclipArea:jt,isObject:Ot,isArray:At}=r.default.helpers,It=new Map;var Wt={id:"annotation",version:"1.2.2",afterRegister(){t.Chart.register(kt),function(t,e,o,n=!0){const i=o.split(".");let r=0;for(const s of e.split(".")){const a=i[r++];if(parseInt(s,10)<parseInt(a,10))break;if(S(a,s)){if(n)throw new Error(`${t} v${o} is not supported. v${e} or newer is required.`);return!1}}return!0}("chart.js","3.7",t.Chart.version,!1)||(console.warn("chartjs-plugin-annotation has known issues with chart.js versions prior to 3.7, please consider upgrading."),t.Chart.defaults.set("elements.lineAnnotation",{callout:{},font:{},padding:6}))},afterUnregister(){t.Chart.unregister(kt)},beforeInit(t){It.set(t,{annotations:[],elements:[],visibleElements:[],listeners:{},listened:!1,moveListened:!1})},beforeUpdate(t,e,o){const n=It.get(t).annotations=[];let i=o.annotations;Ot(i)?Object.keys(i).forEach((t=>{const e=i[t];Ot(e)&&(e.id=t,n.push(e))})):At(i)&&n.push(...i),function(t,e){for(const o of t)y(o,e)}(n,t.scales)},afterDataLimits(t,e){const o=It.get(t);p(0,e.scale,o.annotations.filter((t=>t.display&&t.adjustScaleRange)))},afterUpdate(e,o,n){const i=It.get(e);!function(t,e,o){e.listened=!1,e.moveListened=!1,c.forEach((t=>{"function"==typeof o[t]?(e.listened=!0,e.listeners[t]=o[t]):a(e.listeners[t])&&delete e.listeners[t]})),h.forEach((t=>{"function"==typeof o[t]&&(e.moveListened=!0)})),e.listened&&e.moveListened||e.annotations.forEach((t=>{e.listened||l.forEach((o=>{"function"==typeof t[o]&&(e.listened=!0)})),e.moveListened||h.forEach((o=>{"function"==typeof t[o]&&(e.listened=!0,e.moveListened=!0)}))}))}(0,i,n),function(e,o,n,i){const r=function(e,o,n){if("reset"===n||"none"===n||"resize"===n)return Tt;return new t.Animations(e,o)}(e,n.animations,i),s=o.annotations,a=function(t,e){const o=e.length,n=t.length;if(n<o){const e=o-n;t.splice(n,0,...new Array(e))}else n>o&&t.splice(o,n-o);return t}(o.elements,s);for(let t=0;t<s.length;t++){const o=s[t],n=Yt(a,t,o.type),i=o.setContext(Ht(e,n,o)),d=Xt(i),l=n.resolveElementProperties(e,d);l.skip=isNaN(l.x)||isNaN(l.y),l.options=d,"elements"in l&&(Et(n,l,i,r),delete l.elements),r.update(n,l)}}(e,i,n,o.mode),i.visibleElements=i.elements.filter((t=>!t.skip&&t.options.display))},beforeDatasetsDraw(t,e,o){Nt(t,"beforeDatasetsDraw",o.clip)},afterDatasetsDraw(t,e,o){Nt(t,"afterDatasetsDraw",o.clip)},beforeDraw(t,e,o){Nt(t,"beforeDraw",o.clip)},afterDraw(t,e,o){Nt(t,"afterDraw",o.clip)},beforeEvent(t,e,o){u(It.get(t),e.event,o)},destroy(t){It.delete(t)},_getState:t=>It.get(t),defaults:{animations:{numbers:{properties:["x","y","x2","y2","width","height","pointX","pointY","labelX","labelY","labelWidth","labelHeight","radius"],type:"number"}},clip:!0,dblClickSpeed:350,drawTime:"afterDatasetsDraw",label:{drawTime:null}},descriptors:{_indexable:!1,_scriptable:t=>!c.includes(t),annotations:{_allKeys:!1,_fallback:(t,e)=>`elements.${kt[Rt(e.type)].id}`}},additionalOptionScopes:[""]};const Tt={update:Object.assign};function Rt(t="line"){return kt[t]?t:(console.warn(`Unknown annotation type: '${t}', defaulting to 'line'`),"line")}function Et(t,{elements:e,initProperties:o},n,i){const r=t.elements||(t.elements=[]);r.length=e.length;for(let t=0;t<e.length;t++){const s=e[t],a=s.properties,d=Yt(r,t,s.type,o),l=n[s.optionScope].override(s);a.options=Xt(l),i.update(d,a)}}function Yt(t,e,o,n){const i=kt[Rt(o)];let r=t[e];return r&&r instanceof i||(r=t[e]=new i,Ot(n)&&Object.assign(r,n)),r}function Xt(t){const e=kt[Rt(t.type)],o={};o.id=t.id,o.type=t.type,o.drawTime=t.drawTime,Object.assign(o,Vt(t,e.defaults),Vt(t,e.defaultRoutes));for(const e of c)o[e]=t[e];return o}function Vt(t,e){const o={};for(const n of Object.keys(e)){const i=e[n],r=t[n];o[n]=Ot(i)?Vt(r,i):r}return o}function Ht(t,e,o){return e.$context||(e.$context=Object.assign(Object.create(t.getContext()),{element:e,id:o.id,type:"annotation"}))}function Nt(t,e,o){const{ctx:n,chartArea:i}=t,{visibleElements:r}=It.get(t);o&&Pt(n,i),_t(n,r,e),function(t,e,o){for(const n of e)At(n.elements)&&_t(t,n.elements,o)}(n,r,e),o&&jt(n),r.forEach((t=>{if(!("drawLabel"in t))return;const o=t.options.label;o&&o.enabled&&o.content&&(o.drawTime||t.options.drawTime)===e&&t.drawLabel(n,i)}))}function _t(t,e,o){for(const n of e)n.options.drawTime===o&&n.draw(t)}return t.Chart.register(Wt),Wt}));
